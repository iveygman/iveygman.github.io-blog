<!DOCTYPE html>
<html lang="en">
    <head>
        <title>Instantiating Python Dictionaries</title>
        <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
        <link href="/vendor/twitter-bootstrap/bootstrap/css/bootstrap-responsive.css" rel="stylesheet">
<link href="/vendor/twitter-bootstrap/bootstrap/css/bootstrap.css" rel="stylesheet">
<link href="/vendor/google-code-prettify/google-code-prettify/prettify.css" rel="stylesheet">
<link href="/assets/css/main.css" rel="stylesheet">

        <script type="text/javascript" src="//ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js"></script>
<style TYPE="text/css">
code.has-jax {font: inherit; font-size: 100%; background: inherit; border: inherit;}
</style>
<script type="text/javascript" src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
<script type="text/x-mathjax-config">
MathJax.Hub.Config({
    tex2jax: {
        inlineMath: [['$','$'], ['\\(','\\)']],
        skipTags: ['script', 'noscript', 'style', 'textarea', 'pre'] // removed 'code' entry
    }
});
MathJax.Hub.Queue(function() {
    var all = MathJax.Hub.getAllJax(), i;
    for(i = 0; i < all.length; i += 1) {
        all[i].SourceElement().parentNode.className += ' has-jax';
    }
});
</script>
<style>
.math { height: auto; }
span {height: auto;}
</style>

    </head>
    <body id="page-python-dictionary-speed
">
        
        <div class="container">
            <div class="hero-unit">
    <div class="row">
        <div class="span12">
            <div class="row">
                <div class="span6 intro">
                    <div class="leader">
                        <a href="" id="logo"></a>
                        <h1>I, Veygman</h1>
                        <p>A blog about stuff</p>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

            <div class="row">
                <div class="span8">
                    
                            

    

<div class="post">
    <div class="section section-post-meta post">    
        <h2>            
            <a href="/python-dictionary-speed">
            
                <i class="indicator-icon icon-bullhorn"></i>
                            
                Instantiating Python Dictionaries
            </a>
        </h2>
        <p class="meta">
            November 12, 2014 by <a href="iveygman.github.io">Ilya Veygman</a>
        </p>
    </div>
    



<p>As pretty much anyone who has ever written a Python script knows, you can instantiate empty dictionaries in one of two ways: <code>my_dict = {}</code> or <code>my_dict = dict()</code>. If you’re feeling particularly verbose, you can also do <code>my_dict = types.DictType.__new__(types.DictType, (), {})</code> although that’s not really my cup of tea and I won’t really get into it here.</p>

<p>So what’s the difference between those first two methods? Note: all numbers given here are based on Python 2.7.3 running on a 2012 Macbook Pro running OS X Yosemite.</p>

<h4 id="speed">Speed</h4>

<p>As it turns out, one of these is way faster than the other:</p>

<pre><code>&gt;&gt;&gt; import timeit
&gt;&gt;&gt; timeit.timeit("{}", number=100000)
0.0053899288177490234
&gt;&gt;&gt; timeit.timeit("dict()", number=100000)
0.021266937255859375
</code></pre>

<p><code>dict()</code> is about four times slower than <code>{}</code>. Weird, right? Especially considering that they both return empty dictionaries. So what gives? Doug Hellman goes into some of the reasons <a href="http://doughellmann.com/2012/11/12/the-performance-impact-of-using-dict-instead-of-in-cpython-2-7-2.html">here</a>. In essence, it has to do with how the two dictionaries are allocated under the hood.</p>

<h4 id="disassembly">Disassembly</h4>

<p><code>dis</code>, if you didn’t know, is a disassembler library where you can look at CPython bytecode. Let’s create two functions, <code>lit()</code>, which uses <code>{}</code>, and <code>func</code>, which uses <code>dict()</code>, then disassemble them.</p>

<pre><code>&gt;&gt;&gt; def lit():  return {}
... 
&gt;&gt;&gt; def func(): return dict()
... 
&gt;&gt;&gt; dis.dis(lit)
  1           0 BUILD_MAP                0
              3 RETURN_VALUE        
&gt;&gt;&gt; dis.dis(func)
  1           0 LOAD_GLOBAL              0 (dict)
              3 CALL_FUNCTION            0
              6 RETURN_VALUE     
</code></pre>

<p>Okay so from here, it’s obvious that the two things aren’t doing the same thing under the hood, and, in fact, <code>dict()</code> is doing more. Just knowing that there are extra instructions should be sufficient to understand why one is slower than the other, but just what the hell is <code>dict()</code> doing? You can read Doug Hellman’s article above to get the full detail, but in summary, it turns out that calling <code>dict()</code> with any number of key-value pairs actually creates an intermediate dictionary whereas <code>{}</code> does not.</p>


</div>

                    
                </div>
                <div class="span4 sidebar">
                    <div class="about well">
        <h4 class="well">
            <i class="icon-question-sign"></i> 
           What Is This? 
        </h4>
        <p>
            <strong>I, Veygman is my personal blog/site</strong>
        </p>
        <p>
            I'm a jack-of-all-trades software developer and electrical engineer. I like to work on random things that seem interesting
        </p>
        <a href="/about.html">See more.</a>
</div>

                    <div class="well">
    <h4 class="well"><i class="icon-star-empty"></i> Recent posts</h4>
          <ul class="listless">
      
          <li>
              
              <a href="/hardest-bug-ever">The Strangest Bug I Ever Debugged</a>
              
          </li>
      
          <li>
              
              <a href="/primary-simulator">Sunday Hack&#58; Democratic Primary Simulator</a>
              
          </li>
      
          <li>
              
              <a href="/in-place-swap">Bit Twiddling Tricks 101&#58; The In-Place Swap</a>
              
          </li>
      
          <li>
              
              Instantiating Python Dictionaries
              
          </li>
      
          <li>
              
              <a href="/d3-mondrian-generator">D3.js-based Piet Mondrian Art Generator</a>
              
          </li>
      
      </ul>

    <a href="/archive/" class="btn">All posts <i class="icon-arrow-right"></i></a>   
</div>

                    <div class="well">
    <h4 class="well"><i class="icon-github-sign"></i> Stay up to Date</h4>
    <ul class="repository-list">
        <li><i class="icon-github"></i> <a href="https://github.com/iveygman">github</a></li>
        <li class="icon"><a href="/subscribe">More</a></li>
    </ul>
</div>

                </div>
            </div>
        </div>
    </body>
</html>
